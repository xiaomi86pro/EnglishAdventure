<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English for Kids - Adventure</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Chalkboard+SE:wght@400;700&family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Comic Neue', 'Chalkboard SE', cursive;
            background-color: #f0f9ff;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            display: flex;
            padding: 0.5rem;
            gap: 0.5rem;
        }
        
        /* Hiệu ứng đổ bóng cho các khối */
        .game-card {
            box-shadow: 0 8px 0px rgba(0, 0, 0, 0.1);
            border: 4px solid #fff;
        }

        /* Tùy chỉnh màu sắc hoạt hình */
        #dashboard { background-color: #ffcfd2; }
        #userUI { background-color: #cffaff; }
        #battleview { background-color: #e2f0cb; }
        #questionarea { background-color: #ffffff; }

        /* Scrollbar tùy chỉnh */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #ff9aa2; border-radius: 10px; }

        #battleview {
            position: relative;
            width: 100%;
            height: 260px;
            overflow: hidden;
            --hero-run: 0px;
            --monster-run: 0px;
        }

        #hero, #monster {
            width: 120px;
            height: 120px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center; 
            margin-bottom: 10px;  /* Đổi từ margin-top thành margin-bottom */
        }

        #hero {
            width: 128px;
            height: 128px;
            margin-left: 40px;
        }

        #monster {
            width: 64px;
            height: 64px;
            margin-right: 40px;
            transition: all 0.3s ease;
        }

        #monster.size-normal {
            width: 64px;
            height: 64px;
        }

        #monster.size-elite {
            width: 96px;
            height: 96px;
        }

        #monster.size-boss {
            width: 180px;
            height: 180px;
        }

        /* Hiệu ứng rung khi bị trúng đòn */
        .shake {
            animation: shake-logic 0.4s cubic-bezier(.36,.07,.19,.97) both;
            transform: translate3d(0, 0, 0);
            backface-visibility: hidden;
            perspective: 1000px;
        }

        /* Hiệu ứng hồi máu */
        @keyframes floatUpHeal {
            0%   { opacity: 1; transform: translate(-50%, 0) scale(1); }
            50%  { opacity: 1; transform: translate(-50%, -30px) scale(1.2); }
            100% { opacity: 0; transform: translate(-50%, -60px) scale(0.8); }
        }

        @keyframes healParticle {
            0% { 
                opacity: 1; 
                transform: translate(-50%, -50%) translate(0, 0) scale(1); 
            }
            100% { 
                opacity: 0; 
                transform: translate(-50%, -50%) translate(var(--heal-tx), var(--heal-ty)) scale(0.3); 
            }
        }

        .heal-popup {
            user-select: none;
        }    

        @keyframes fadeOut {
            from { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            to { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
        }
       
        @keyframes shake-logic {
            10%, 90% { transform: translate3d(-2px, 0, 0); }
            20%, 80% { transform: translate3d(4px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-8px, 0, 0); }
            40%, 60% { transform: translate3d(8px, 0, 0); }
        }

        /* Hiệu ứng ngôi sao văng ra */
        .star-particle {
            position: absolute;
            pointer-events: none;
            font-size: 24px;
            z-index: 100;
            user-select: none;
            animation: star-fly 0.7s ease-out forwards;
        }

        @keyframes star-fly {
            0% { transform: translate(0, 0) scale(1) rotate(0deg); opacity: 1; }
            100% { transform: translate(var(--tx), var(--ty)) scale(0) rotate(360deg); opacity: 0; }
        }

        .glow-en {
        box-shadow: 
            0 0 10px #3b82f6,   /* xanh dương nhạt */
            0 0 20px #3b82f6, 
            0 0 40px #3b82f6, 
            0 0 80px #3b82f6;   /* xanh dương đậm */
        }

        .glow-vi {
        box-shadow: 
            0 0 10px #22c55e,   /* xanh lá nhạt */
            0 0 20px #22c55e, 
            0 0 40px #22c55e, 
            0 0 80px #22c55e;   /* xanh lá đậm */
        }
        .damage-popup {
        position: absolute;
        transform: translate(-50%, 0);
        font-size: 48px;
        font-weight: 900;
        color: #ff3333;
        text-shadow: 0 0 6px #fff;
        animation: floatUp 1.5s ease-out forwards;
        pointer-events: none;
        z-index: 50;
        }

        @keyframes floatUp {
            0%   { opacity: 1; transform: translate(-50%, 0); }
            100% { opacity: 0; transform: translate(-50%, -50px); }
        }

        #preview-area {
        min-height: 80px; /* hoặc chiều cao bạn muốn giữ */
        }

        #hero.run-forward {
        transform: translateX(120px); /* hero lao sang phải */
        transition: transform 0.4s ease;
        }

        #hero.run-back {
        transform: translateX(0); /* quay về */
        transition: transform 0.4s ease;
        }

        #monster.run-forward {
        transform: translateX(-120px); /* quái lao sang trái nếu cần */
        transition: transform 0.4s ease;
        }

        #monster.run-back {
        transform: translateX(0);
        transition: transform 0.4s ease;
        }

        #answer-history { 
            position: fixed; /* cố định theo màn hình */ 
            right: 0; 
            top: 0; 
            width: 250px; 
            height: 100vh; /* chiếm toàn bộ chiều cao màn hình */ 
            overflow-y: auto; /* có thanh cuộn */ 
            background: rgba(255,255,255,0.8); 
            padding: 10px; 
            box-sizing: border-box; 
            z-index: 50; /* đảm bảo nổi lên trên */ 
        }

        #answers-history::-webkit-scrollbar-thumb { 
            background-color: rgba(0,0,0,0.3); 
            border-radius: 3px; 
        }

        @keyframes shake-wrong {
        0%, 100% { transform: translateX(0); }
        25% { transform: translateX(-10px); }
        75% { transform: translateX(10px); }
        }

        .animate-shake {
            animation: shake-wrong 0.3s ease-in-out;
        }

    </style>
</head>
<body>

    <!-- 1. Cột UserUI bên trái (1/6 màn hình, dài hết cỡ) -->
    <aside id="userUI" class="w-1/6 h-full rounded-3xl p-4 flex flex-col items-center gap-6 game-card">
        <!-- Nội dung sẽ được thêm vào đây -->
    </aside>

    <!-- 3. Khung Container ở giữa (Chiếm phần còn lại) -->
    <main id="container" class="flex-1 h-full flex flex-col gap-2">
        
        <!-- Vùng 1: Battle View (1/3 khung giữa) -->
        <section id="battleview" class="h-1/3 rounded-3xl p-4 game-card relative overflow-hidden">
            <div class="flex justify-between items-center h-full">
                <div id="hero" class="sprite"></div>
                <div id="monster" class="sprite"></div>
            </div>
        </section>

        <!-- Vùng 2: Question Area (Phần còn lại chiếm 2/3) -->
        <section id="questionarea" class="flex-1 rounded-3xl p-6 game-card flex flex-col items-center justify-center">
            <!-- Nội dung sẽ được thêm vào đây -->
        </section>
    </main>

    <!-- 2. Cột Dashboard bên phải (1/6 màn hình, dài hết cỡ) -->
    <aside id="dashboard" class="w-1/6 h-full rounded-3xl p-4 flex flex-col gap-4 game-card">
        <div id="monster-info"></div>
        <div id="answers-history" class="mt-4 space-y-2 flex-1 overflow-y-auto pr-2"></div>
        <div class="mt-auto border-t-2 border-white/50 pt-4">          
            <a href="admin.html" class="flex items-center gap-2 p-3 rounded-2xl bg-white/30 hover:bg-white/50 transition-all text-red-600 font-bold group">
                <span class="text-2xl group-hover:rotate-90 transition-transform duration-500">⚙️</span>
                <span class="text-sm uppercase tracking-wider">Quản trị</span>
            </a>
        </div>
    </aside>

    <script type="module" src="js/supabase_config.js"></script>
    <script src="./js/auth_component.js"></script>
    <script src="./js/game_engine.js"></script>
    <script type="module" src="./js/question/question_manager.js"></script>
    <script>
        // Đảm bảo Supabase đã load xong rồi mới init Auth
        window.addEventListener('load', () => {
            if (window.AuthComponent) {
                AuthComponent.init();
            }
        });
    </script>

</body>
</html>